#!/bin/sh

# Unmount the volume if needed and if needed unmount the device for the evhd.

VAULT=$1

echo "Unmounting $VAULT..."
mountpoint -q /mnt/$VAULT
if [ $? -eq 0 ] ; then
  sudo umount /mnt/$VAULT
fi
sudo cryptsetup status $VAULT.evhd >> //dev/null
RTN=$?
if [ $RTN -eq 0 ] || [ $RTN -eq 4 ] ;  then # check device exists
 sudo cryptsetup luksClose $VAULT.evhd
else
 echo $RTN
 sudo cryptsetup status $VAULT.evhd
 echo $?
fi


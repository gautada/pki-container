#!/bin/sh

# vault-umount: Unmounts from mount point and closes the device placing back into secure encrypted state. This script should be fail safe and attemp to put the vault in the most secure state possible.

# echo "[INFO] Unmount vault"
/bin/mountpoint -q /mnt/vault
if [ $? -eq 0 ] ; then
 /usr/bin/sudo /bin/umount /mnt/vault
else
 if [ -f /mnt/vault/.last ] ; then
  echo "[WARN] Forcing umount"
  /usr/bin/sudo /bin/umount -f /mnt/vault
 fi
fi

# echo "[INFO] Close vault"
/usr/bin/sudo /sbin/cryptsetup status vault >> /dev/null
if [ ! $? -eq 4 ] ; then
 /usr/bin/sudo /sbin/cryptsetup luksClose vault
fi

